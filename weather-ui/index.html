<html>
   <head>
	<script src="js/constants.js" ></script>
      <script type="text/javascript">

      	function fetchDataAndUpdateCityDropDown(){
      		fetch(baseUrl + 'city/detail', {
		         method: 'GET', // or 'PUT'
		         //mode: 'no-cors',
		         headers: {
		          'Content-Type': 'application/json',
		          'Access-Control-Allow-Origin': '*',
		          //'Access-Control-Allow-Credentials': 'false',
		         },
	         })
	         .then(response => {
				if(response.status == 200){
                    return response.json();
                }else{
                    return "Failure";
                }
			 })
	         .then(data => {
				 if(data == 'Failure'){
					alert('Link Is Broken Please Try Again In Some Time');
				 }else{
					updateCityDropDown(data);
				 }
	         })
	         .catch((error) => {
	         	console.error('Error:', error);
				alert('Link Is Broken Please Try Again In Some Time');
	         });
      	}

		function updateCityDropDown(data){
			let dropDownHtml = `<content>
            <form name="formid">
               <div class="form-row">
                  <div class="form-group col-md-3">
                     <label for="exampleFormControlSelect1">Select City</label>
                     <select class="form-control form-control-sm mx-sm-3" id="exampleFormControlSelect1" name="ddlselect" onchange="getddl()">`;

                     data.forEach(function(cValue){
                     	let row = `<option value="${cValue}">${cValue}</option>`;
                     	dropDownHtml = dropDownHtml + row;
                     });

                     let dropDownEndHtml = `</select>
                  </div>
               </div>
            </form>
         </content>`;
	         
	         dropDownHtml = dropDownHtml + dropDownEndHtml;

	         document.getElementById('cityDropDown').innerHTML=dropDownHtml;

	         getddl()
		}
         
         fetchDataAndUpdateCityDropDown()
		 
         
         function getddl(){
         
	         let url = baseUrl + "weather/detail?city=" + formid.ddlselect[formid.ddlselect.selectedIndex].text;
	         console.log("url : " + url)
	         
	         let value = fetchAndUpdateData(url)
	         
	          console.log(value)
         }
         
         
         
         function fetchAndUpdateData(url) {
         
	         fetch(url, {
		         method: 'GET', // or 'PUT'
		         //mode: 'no-cors',
		         headers: {
		          'Content-Type': 'application/json',
		          'Access-Control-Allow-Origin': '*',
		          //'Access-Control-Allow-Credentials': 'false',
		         },
	         })
	         .then(response => {
				if(response.status == 200){
                    return response.json();
                }else{
                    return "Failure";
                }
			 })
	         .then(data => {
				if(data == 'Failure'){
					alert('Link Is Broken Please Try Again In Some Time');
				 }else{
					updateDataInTable(data);
				}
	         })
	         .catch((error) => {
	         	console.error('Error:', error);
				 alert('Link Is Broken Please Try Again In Some Time');
	         });
         
         }
         
         function updateDataInTable(data){
	         console.log(data.weatherDayData)
	         
	         let tableHtml = `<div class="container mb-3 mt-3">
	         <table class="table table-striped table-bordered mydatatable" style="width:100%">
	              <thead>
	                  <tr>
	                      <th>Date</th>
	                      <th>Day Min Temp</th>
	                      <th>Day Max Temp</th>
	                      <th>Wind Speed</th>
	                      <th>Description</th>
	                      <th>Suggestion</th>
						  <th>Options</th>
	                  </tr>
	              </thead>
	              <tbody>`;
	         
	         data.weatherDayData.forEach(function(cValue){
		         let weatherinfo = cValue.weatherInfo;
		         let date = new Date(cValue.date);
		         if(weatherinfo.suggestion == null){
		         	weatherinfo.suggestion = "Have a nice Day"
		         }
		         let row = `<tr>
		                      <td>${date}</td>
		                      <td>${weatherinfo.tempMin}</td>
		                      <td>${weatherinfo.tempMax}</td>
		                      <td>${cValue.wind.speed}</td>
		                      <td>${cValue.weather[0].description}</td>
		                      <td>${weatherinfo.suggestion}</td>
							  <td>
							
								<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" onclick="createAndSetChartUrl('${data.city.name}','${cValue.date}')">
									Details
  								</button>
								
							  </td>     
		                  </tr>`;
		                  tableHtml = tableHtml + row;
	         },data);
	         
	         let tableEndHtml = `</tbody>
	          </table>
	         </div>`;
	         
	         tableHtml = tableHtml + tableEndHtml;
	         
	         document.getElementById('lblmess').innerHTML=tableHtml;
	         $('.mydatatable').dataTable();
         }
         
          
		//  function createAndSetChartUrl(url){
		// 	 console.log(url);
		// 	 localStorage.url = url;
		//  }
         
      </script>
	  <script src="https://code.highcharts.com/highcharts.js"></script>
	  <script src="https://code.highcharts.com/modules/series-label.js"></script>
	  <script src="https://code.highcharts.com/modules/exporting.js"></script>
	  <script src="https://code.highcharts.com/modules/export-data.js"></script>
	  <script src="https://code.highcharts.com/modules/accessibility.js"></script>
      <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
	  <link rel="stylesheet" href="css/chart.css">
   </head>
   <body>
      <div class="container mb-3 mt-3">
      	<div id="cityDropDown"></div>
         <!-- <content>
            <form name="formid">
               <div class="form-row">
                  <div class="form-group col-md-3">
                     <label for="exampleFormControlSelect1">Select City</label>
                     <select class="form-control form-control-sm mx-sm-3" id="exampleFormControlSelect1" name="ddlselect" onchange="getddl()">
                        <option value="indore" selected>indore</option>
                        <option value="raipur">raipur</option>
                        <option value="pune">pune</option>
                        <option value="london">london</option>
                     </select>
                  </div>
               </div>
            </form>
         </content> -->
      </div>
      <div id="lblmess"></div>


	 <!-- Button trigger modal -->
<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" onclick="createAndSetChartUrl('new')">
	Launch demo modal
  </button> -->

<div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="exampleModalLabel">Hourly Temperature Chart</h5>
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		<div class="modal-body">
		  
			<figure class="highcharts-figure w-100">
				<div id="container"></div>
				<p class="highcharts-description">
				  
				</p>
			  </figure>

		</div>
	  </div>
	</div>
  </div>

  <!-- <td><a href="chart.html" class="btn btn-info" role="button" onclick="createAndSetChartUrl('${data.city.name}','${date}')">Details</a></td> -->


      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
      <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
      <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js" ></script>
      <script type="text/javascript">
          function createAndSetChartUrl(city, date){
			fetch(baseUrl + 'weather/detail/qhourly?city=' + city + "&date=" + date, {
		         method: 'GET', // or 'PUT'
		         //mode: 'no-cors',
		         headers: {
		          'Content-Type': 'application/json',
		          'Access-Control-Allow-Origin': '*',
		          //'Access-Control-Allow-Credentials': 'false',
		         },
	         })
	         .then(response => {
				if(response.status == 200){
                    return response.json();
                }else{
                    return "Failure";
                }
			 })
	         .then(data => {
				 if(data == 'Failure'){
					alert('Link Is Broken Please Try Again In Some Time');
				 }else{
					updateChart(data);
				 }
	         })
	         .catch((error) => {
	         	console.error('Error:', error);
				alert('Link Is Broken Please Try Again In Some Time');
	         });
		 }
      </script>
	  <script src="js/chart.js" ></script>
	  <script>
		 // updateChart();
		  //console.log(localStorage.url)
		  //console.log(localStorage.date)
	  </script>
   </body>
</html>